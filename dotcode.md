# Generating a DotCode

This document shows how to take a **5-byte ID** (as generated by our [Compact ID scheme](../id-generation-guide.md)) and produce a **DotCode** image (or QR code) using [bwip-js](https://github.com/metafloor/bwip-js). 
An online demo can be seen [here](https://bwip-js.metafloor.com/demo/demo.html).
We'll use **TypeScript** for the examples.

---

## 1. Overview

**bwip-js** is a Node.js library for generating barcodes and 2D codes. Among its supported symbologies:

- **DotCode** – specified as `bcid: "dotcode"`.  
- **QR Code** – specified as `bcid: "qrcode"`.

Below, we'll demonstrate **DotCode** generation from a compact ID. The **same approach** applies for **QR code**; just change `bcid` to `"qrcode"` and adjust parameters if needed.

---

## 2. Converting the 5-Byte ID to a String

### 2.1. Raw vs. Text

- Some barcode scanners can handle raw binary data, but many prefer **ASCII**-encoded text.  
- We typically convert the **5-byte** ID to **hex** or **Base64** for easy scanning and display.  
- **bwip-js** expects a string for its `text` property, so providing a hex string is usually simplest.

### 2.2. Example Code

```ts
/**
 * Convert a 5-byte ID (Uint8Array) to a hex string
 * e.g. [0x00, 0x63, 0xb9, 0x0d, 0xe0] -> "0063b90de0"
 */
function idBytesToHex(idBytes: Uint8Array): string {
  return Array.from(idBytes)
    .map((b) => b.toString(16).padStart(2, "0"))
    .join("");
}
```

## 3. Example using bwip-js

```ts
import bwipjs from "bwip-js";

/**
 * Generates a DotCode SVG using bwip-js from a given payload string.
 * @param data   The string to encode (e.g., hex form of the ID).
 * @param scale  The size of each module (default=3).
 * @returns      Promise resolving to the generated SVG string.
 */
export async function generateDotCodeSvg(
  data: string,
  scale = 3
): Promise<string> {
  return new Promise((resolve, reject) => {
    bwipjs.toBuffer(
      {
        bcid: "dotcode",     // DotCode symbology
        text: data,          // The string to encode (our ID in hex)
        scale,               // Adjust module size
        render: "svg",       // Output SVG markup
        includetext: false,  // DotCode typically doesn't need text below
      },
      (err, svgBuffer) => {
        if (err) {
          return reject(err);
        }
        resolve(svgBuffer.toString("utf8"));
      }
    );
  });
}
```
